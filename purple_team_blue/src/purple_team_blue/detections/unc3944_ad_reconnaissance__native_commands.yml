title: UNC3944 AD Reconnaissance - Native Commands
id: 3e4f5a6b-7c8d-9e0f-1a2b-3c4d5e6f7a8b
status: stable
description: Detects the use of native Windows commands (nltest, net.exe) for Active
  Directory reconnaissance, a common LOLBin technique used by threat actors like UNC3944
  (Scattered Spider). Focuses on enumeration of domain controllers, domain administrators,
  and domain users.
references:
- https://attack.mitre.org/groups/G1012/
- https://attack.mitre.org/techniques/T1201/
- https://attack.mitre.org/techniques/T1201.001/
- https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/nltest
- https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/net-group
author: Principal Detection Strategist
date: 2023/11/02
modified: 2023/11/02
tags:
- attack.group_G1012
- attack.t1201
- attack.t1201.001
- attack.tactic.discovery
- attack.defense_evasion
- detection.ad_reconnaissance
- os.windows
- sysmon
- security
level: high
logsource:
  product: windows
  category: process_creation
detection:
  selection:
    EventID:
    - 1
    - 4688
    ParentImage|endswith:
    - \cmd.exe
    - \powershell.exe
    - \pwsh.exe
    CommandLine|contains:
    - 'nltest /dclist:'
    - net group "domain admins" /domain
    - net.exe group "domain admins" /domain
    - net user /domain
  condition: selection
fields:
- EventID
- ComputerName
- User
- CommandLine
- ParentCommandLine
- ParentImage
- Image
- OriginalFileName
- Hashes
- ProcessId
- ParentProcessId
- LogonId
